
__Copyrights and Licences__

Files using Copyright 2023 Google LLC & Apache License Version 2.0:
* service_callout.py contains service callout server code
* test_server.py contains code to test the service_callout.py

Following files are auto-generated by debian grpc-tools
* service_pb2.py
* service_pb2_grpc.py

Proto file `protos/service.proto` is from https://github.com/envoyproxy/envoy/
and uses [Apache License Version 2.0](https://github.com/envoyproxy/envoy/blob/main/LICENSE).


# Quick start 

This server requires the `grpcio` and `grpcio-tools` python packages.


The prefered method of installation is with a virtual enviornment through `venv`. To set up the virtual enviornment run:
```
python -m venv env
source env/bin activate
```
Then the packages can be installed with:
```
pip install -r requirements.txt
```
And if you want to run tests:
```
pip install -r requirements-test.txt
```

### Without `venv`

Alternatively, the packages can be installed through the package manager:
```
sudo apt-get install python3-grpcio -y
```

## Running
The server can then be started from the `callouts/python` directory or from the install location with:

```
python service_callout.py
```

The server will then run until interupted, for example, by inputing `Ctrl-C`. 

# Tests

Tests can be run with:
```
pytest test_server.py
```

# Building Docker

Since the Docker image requires certificates from `ssl_creds` we build our image from the parent directory. So, to build the docker image from this current directory; run:
```
cd ..
docker build -f ./python/Dockerfile -t service-callout-example .
```

And to run the image:

```
docker run --network host -P service-callout-example
```

Using the `-P` flag tells the docker to connect the exposed ports to the local machine's ports. Additionally, setting `--network host` tells docker to connect the image to the `0.0.0.0` or `localhost` ip address. 

# TODO
- Split out the server into two files so that grpc packages are not needed when just using the HTTP version of the server.