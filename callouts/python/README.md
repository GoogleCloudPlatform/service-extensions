
__Copyrights and Licences__

Files using Copyright 2023 Google LLC & Apache License Version 2.0:
* service_callout.py contains service callout server code
* test_server.py contains code to test the service_callout.py

Following files are auto-generated by debian grpc-tools
* service_pb2.py
* service_pb2_grpc.py

Proto file `protos/service.proto` is from https://github.com/envoyproxy/envoy/
and uses [Apache License Version 2.0](https://github.com/envoyproxy/envoy/blob/main/LICENSE).


# Quick start 

This server requires the `grpcio` and `grpcio-tools` python packages.


The prefered method of installation is with a virtual enviornment through `venv`. To set up the virtual enviornment run:
```
python -m venv env
source env/bin activate
```
Then the packages can be installed with:
```
pip install -r requirements.txt
```
And if you want to run tests:
```
pip install -r requirements-test.txt
```

### Without `venv`

Alternatively, the packages can be installed through the package manager:
```
sudo apt-get install python3-grpcio -y
```

## Running
Example servers can be started from the `extproc/example/<...>` submodules. 
For example the grpc `service_callout_example` server can be started with:

```
python -m extproc.example.grpc.service_callout_example
```

The server will then run until interupted, for example, by inputing `Ctrl-C`. 

# Tests

Tests can be run with:
```
pytest
```

# Building Docker

To build an example docker image call `docker build -f <path> -t <image> .` 
where `<path>` is the path to the Dockerfile within the desired example submodule, 
and `<image>` is the desired docker image name:
For example, you can build the example grpc server image `service-callout-example-python` with:
```
docker build -f ./extproc/example/grpc/Dockerfile -t service-callout-example-python .
```

You can then run the image with:

```
docker run --network host -P service-callout-example-python
```

Using the `-P` flag tells the docker to connect the exposed ports to the local machine's ports. 
Additionally, setting `--network host` tells docker to connect the image to the `0.0.0.0` or `localhost` ip address.
