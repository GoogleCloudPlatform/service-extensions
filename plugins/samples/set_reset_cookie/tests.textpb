test {
  name: "SetNewSessionCookie"
  request_headers {
    input { header { key: "Cookie" value: "other_cookie=some_value" } }
  }
  response_headers {
    result { 
      header { key: "Set-Cookie" value: "session_id=12345; Path=/; HttpOnly" }
      log { regex: ".+Setting session cookie: session_id=12345" }
    }
  }
}

test {
  name: "SetPersistentDomainCookie"
  request_headers {
    input { header { key: "Cookie" value: "" } }
  }
  response_headers {
    result { 
      header { key: "Set-Cookie" value: "user_pref=dark_mode; Path=/; Domain=example.com; Max-Age=86400; HttpOnly; Secure" }
      log { regex: ".+Setting persistent cookie: user_pref=dark_mode" }
    }
  }
}

test {
  name: "DeleteCookieBeforeCDNCache"
  request_headers {
    input { 
      header { key: "Cookie" value: "session_id=abc123; old_cookie=expired; user_pref=value" }
    }
    result {
      header { key: "Cookie" value: "session_id=abc123; user_pref=value" }
      log { regex: ".+Marking cookie for deletion before CDN cache: old_cookie" }
    }
  }
  response_headers {
    result { 
      no_header { key: "Set-Cookie" }
    }
  }
}

test {
  name: "OverwriteExistingCookieWithNewValue"
  request_headers {
    input { header { key: "Cookie" value: "tracking_id=old_value" } }
  }
  response_headers {
    result { 
      header { key: "Set-Cookie" value: "tracking_id=new_value; Path=/; Domain=.example.com; Max-Age=3600; HttpOnly; Secure" }
      log { regex: ".+Overwriting existing cookie: tracking_id" }
    }
  }
}

test {
  name: "RemoveSetCookieDirectiveCompletely"
  request_headers {
    input { header { key: "Cookie" value: "remove_me=value" } }
  }
  response_headers {
    result { 
      header { key: "Set-Cookie" value: "remove_me=; Path=/; Max-Age=0" }
      log { regex: ".+Removing Set-Cookie directive for: remove_me" }
    }
  }
}
